<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>SolarSanchay ‚Äì Solar Saving Calculator</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body { background:#f6f7fb; }

.intent-card {
  cursor:pointer;
  border-left:6px solid transparent;
  background:#fff;
}
.intent-card.one { border-left-color:#0d6efd; background:#f1f6ff; }
.intent-card.save { border-left-color:#198754; background:#f1fbf5; }
.intent-card.active { box-shadow:0 0 0 2px rgba(0,0,0,0.08); }

.helper-wrapper {
  background:#f8f9fa;
  border:2px dashed #ced4da;
}

.helper-card { border:1px solid #dee2e6; background:#fff; }

.section-card { background:#fff; }

.result-box { background:#f8f9fa; padding:12px; border-radius:6px; margin-bottom:10px; }
</style>
</head>

<body>
<div class="container py-4">

<h3 class="mb-3 text-center">‚òÄÔ∏è SolarSanchay</h3>

<!-- INTENT SELECTION -->
<div id="intentSection" class="row g-3">
  <div class="col-md-6">
    <div class="card intent-card one p-3" onclick="selectIntent('one')">
      <h6>üîç One-time Solar Saving Check</h6>
      <small class="text-muted">Quick calculation, no data saved</small>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card intent-card save p-3" onclick="selectIntent('save')">
      <h6>üíæ Save for Future Reference</h6>
      <small class="text-muted">Store bill details for tracking</small>
    </div>
  </div>
</div>

<!-- HELPER CARDS -->
<div id="helperCards" class="helper-wrapper p-3 mt-4">
  <div class="row g-3">
    <div class="col-md-4">
      <div class="card helper-card p-3">
        <b>Download Electricity Bill</b>
        <small class="text-muted d-block">
          <a href="https://www.uhbvn.org.in/web/portal/auth?lastPage=/view-bill" target="_blank">
            UHBVN Bill Portal
          </a>
        </small>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card helper-card p-3">
        <b>What is Gross / Import / Export?</b>
        <small class="text-muted">Understand bill parameters</small>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card helper-card p-3">
        <b>How Solar Saving is Calculated</b>
        <small class="text-muted">Transparent formula</small>
      </div>
    </div>
  </div>
</div>

<!-- INTENT SUMMARY -->
<div id="intentSummary" class="alert alert-info d-none mt-3">
  <span id="intentText"></span>
  <button class="btn btn-sm btn-link" onclick="resetIntent()">Change</button>
</div>

<!-- IDENTITY (SAVE MODE ONLY) -->
<div id="identitySection" class="card section-card p-3 mt-3 d-none">
  <h6>Consumer Identification</h6>
  <label>Bill Number</label>
  <input id="billNumber" class="form-control mb-2">
  <label>Meter / Account / Reference ID</label>
  <input id="meter" class="form-control">
  <small class="text-muted">
    Used only to identify records. Not a login or password.
  </small>
</div>

<!-- CONSUMPTION -->
<div id="consumptionSection" class="card section-card p-3 mt-3 d-none">

<h6>Consumption & Charges</h6>

<div id="billPeriodSection" class="mb-3">
  <label>Bill From</label>
  <input type="date" id="billFrom" class="form-control mb-2">
  <label>Bill To</label>
  <input type="date" id="billTo" class="form-control">
</div>

<div id="carryForwardSection" class="mb-2 d-none">
  <label>Opening Carry Forward Units</label>
  <input id="openingCarry" class="form-control" oninput="handleNumericInput(this)">
  <small class="text-muted">From previous bills (reset in April)</small>
</div>

<label>Gross Units</label>
<input id="gross" class="form-control mb-2" oninput="handleNumericInput(this)">

<label>Import Units</label>
<input id="importU" class="form-control mb-2" oninput="handleNumericInput(this)">

<label>Export Units</label>
<input id="exportU" class="form-control mb-2" oninput="handleNumericInput(this)">

<label>Fixed Charges ‚Çπ</label>
<input id="fixed" class="form-control mb-2" oninput="handleNumericInput(this)">

<label>Total Bill Amount ‚Çπ</label>
<input id="totalBill" class="form-control mb-2" oninput="handleNumericInput(this)">

<label>Arrears ‚Çπ (if any)</label>
<input id="arrears" class="form-control mb-2" oninput="handleNumericInput(this)">
</div>

<button id="actionBtn" class="btn btn-primary w-100 mt-3 d-none" onclick="handleAction()">
Calculate
</button>

</div>

<!-- RESULT MODAL -->
<div class="modal fade" id="resultModal">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">SolarSanchay ‚Äì Result</h5>
        <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body" id="resultBody"></div>
    </div>
  </div>
</div>

<footer class="mt-5 py-3 text-center bg-light border-top">
  <small class="text-muted">
    Developed by <b>National Informatics Centre (NIC), Kurukshetra</b><br>
    for <b>District Administration, Kurukshetra</b>
  </small>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
let entryMode = null;

function handleNumericInput(el){
  if(entryMode === "save"){
    el.value = el.value.replace(/[^0-9]/g,'');
  } else {
    el.value = el.value.replace(/[^0-9+ ]/g,'');
  }
}

function selectIntent(type){
  entryMode = type;
  document.getElementById("helperCards").classList.add("d-none");
  document.getElementById("intentSection").classList.add("d-none");
  document.getElementById("intentSummary").classList.remove("d-none");
  document.getElementById("consumptionSection").classList.remove("d-none");
  document.getElementById("actionBtn").classList.remove("d-none");

  document.getElementById("intentText").innerHTML =
    type==="one" ? "One-time calculation (no data saved)" :
    "Save bill for future reference";

  if(type==="save"){
    document.getElementById("identitySection").classList.remove("d-none");
    document.getElementById("carryForwardSection").classList.remove("d-none");
    actionBtn.innerText="üíæ Save & Submit";
  } else {
    document.getElementById("identitySection").classList.add("d-none");
    document.getElementById("carryForwardSection").classList.add("d-none");
    actionBtn.innerText="üîç Calculate Saving";
  }
}

function resetIntent(){
  location.reload();
}

function handleAction(){
  calculate();
}

function calculate(){
  const g = Number(gross.value||0);
  const i = Number(importU.value||0);
  const e = Number(exportU.value||0);
  const f = Number(fixed.value||0);
  const t = Number(totalBill.value||0);
  const opening = entryMode==="save" ? Number(openingCarry.value||0) : 0;

  const net = i - e;
  let adjusted = net - opening;

  let billable=0, carry=0;
  if(adjusted>0){ billable=adjusted; } else { carry=Math.abs(adjusted); }

  const unitRate = billable>0 ? (t-f)/billable : 0;
  const without = (g*unitRate)+f;

  let html=`
    <div class="result-box">
      <b>Gross:</b> ${g} |
      <b>Import:</b> ${i} |
      <b>Export:</b> ${e}<br>
      <b>Opening Carry:</b> ${opening}
    </div>

    <div class="result-box row text-center">
      <div class="col-6">
        <b>Without Solar</b><br>
        ‚Çπ${without.toFixed(0)}
      </div>
      <div class="col-6">
        <b>With Solar</b><br>
        ‚Çπ${t}
      </div>
    </div>

    <div class="result-box">
      <b>Saving:</b> ‚Çπ${(without-t).toFixed(0)}<br>
      <b>Closing Carry Forward:</b> ${carry} units
    </div>
  `;

  document.getElementById("resultBody").innerHTML=html;
  new bootstrap.Modal(document.getElementById("resultModal")).show();
}
</script>

</body>
</html>
