<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SolarSanchay ‚Äì Haryana | Solar Saving Calculator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body { background:#f4f6fb; }

.header {
  background:#fff;
  border-bottom:4px solid #0b5ed7;
  padding:14px 0;
}

.hero {
  background:linear-gradient(135deg,#0b5ed7,#084298);
  color:#fff;
  padding:26px;
  border-radius:12px;
  margin-bottom:28px;
}

.card { border-radius:12px; }

.mode-card {
  cursor:pointer;
  border:2px solid #dee2e6;
  transition:0.3s;
}
.mode-card:hover {
  border-color:#0b5ed7;
  box-shadow:0 0 14px rgba(11,94,215,0.2);
}
.mode-card.active {
  border-color:#0b5ed7;
  background:#e7f1ff;
}

.result-box {
  background:#ffffff;
  border-left:6px solid #0b5ed7;
  padding:22px;
  border-radius:10px;
  box-shadow:0 4px 14px rgba(0,0,0,0.05);
}

footer {
  background:#fff;
  border-top:2px solid #dee2e6;
  margin-top:50px;
  padding:18px 0;
  font-size:14px;
}

.form-check-input { transform:scale(1.3); }
/* ================= MOBILE FIXES ================= */
@media (max-width: 768px) {

  /* Header stacking */
  .header .container {
    flex-direction: column;
    align-items: center !important;
    text-align: center;
  }

  .header img {
    margin-bottom: 10px;
  }

  /* Hero spacing */
  .hero {
    padding: 18px;
  }

  .hero h3 {
    font-size: 1.3rem;
  }

  /* Mode cards stack */
  .mode-card {
    margin-bottom: 15px;
  }

  /* Cards padding reduction */
  .card {
    padding: 15px !important;
  }

  /* Form spacing */
  .form-control {
    margin-bottom: 10px;
  }

  /* Result readability */
  .result-box h3 {
    font-size: 1.4rem;
  }

  .result-box p {
    font-size: 0.95rem;
  }

  /* Footer stacking */
  footer .container {
    flex-direction: column;
    text-align: center;
    gap: 10px;
  }
}

  
</style>
</head>

<body>

<!-- ================= HEADER ================= -->
<div class="header">
  <div class="container d-flex justify-content-between align-items-center flex-wrap">
    <div class="d-flex align-items-center">
      <img src="assests/haryana-logo.jpg" style="height:64px;margin-right:14px;">
      <div>
        <h4 class="mb-0 fw-bold">SolarSanchay ‚Äì Haryana</h4>
        <small class="text-muted">Solar Savings Estimation Portal</small>
      </div>
    </div>
    <div class="text-end">
      <small class="text-muted d-block">Government of Haryana</small>
      <small class="text-muted">National Informatics Centre, Kurukshetra</small>
    </div>
  </div>
</div>

<div class="container my-4">

<!-- ================= HERO ================= -->
<div class="hero">
  <h3>‚òÄÔ∏è Know Your Solar Savings</h3>
  <p class="mb-0">
    Calculate how much money you saved using your solar system,
    based on actual electricity bill values.
  </p>
</div>

<!-- ================= MODE SELECTION ================= -->
<div class="row mb-4">
  <div class="col-md-6">
    <div class="card mode-card active" id="manualCard" onclick="selectMode('manual')">
      <div class="card-body text-center">
        <div style="font-size:40px;">‚úçÔ∏è</div>
        <h5 class="mt-2">Enter Bill Details</h5>
        <p class="text-muted mb-0">Manual entry from electricity bill</p>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card mode-card" id="scanCard" onclick="selectMode('scan')">
      <div class="card-body text-center">
        <div style="font-size:40px;">üì∑</div>
        <h5 class="mt-2">Scan Electricity Bill</h5>
        <p class="text-muted mb-0">OCR ‚Äì Coming Soon</p>
      </div>
    </div>
  </div>
</div>

<!-- ================= RECORD PREFERENCE ================= -->
<div class="card p-3 mb-3">
  <h5>üìÅ What do you want to do?</h5>

  <div class="form-check mt-2">
    <input class="form-check-input" type="radio"
           name="saveOption" value="no" checked
           onchange="toggleIdentitySection()">
    <label class="form-check-label fw-semibold">
      Just check saving for this bill (no data saved)
    </label>
    <div class="text-muted small">
      Recommended for quick check and privacy
    </div>
  </div>

  <div class="form-check mt-3">
    <input class="form-check-input" type="radio"
           name="saveOption" value="yes"
           onchange="toggleIdentitySection()">
    <label class="form-check-label fw-semibold">
      Save this bill for future reference
    </label>
    <div class="text-muted small">
      Enables cycle-wise history and long-term analysis
    </div>
  </div>
</div>

<!-- ================= CONSUMER IDENTIFICATION (HIDDEN BY DEFAULT) ================= -->
<div class="card p-3 mb-3 d-none" id="identitySection">
  <h5>üîç Consumer Identification</h5>

  <div class="row">
    <div class="col-md-6">
      <label>Bill Number <span class="text-danger">*</span></label>
      <input class="form-control" id="billNumber">
    </div>
    <div class="col-md-6">
      <label>Meter Number</label>
      <input class="form-control" id="meter">
    </div>
  </div>

  <div class="row mt-2">
    <div class="col-md-6">
      <label>Account Number</label>
      <input class="form-control" id="account">
    </div>
    <div class="col-md-6 d-flex align-items-end">
      <small class="text-muted">
        * Either Meter Number or Account Number required
      </small>
    </div>
  </div>
</div>

<!-- ================= BILL PERIOD ================= -->
<div class="card p-3 mb-3">
  <h5>üìÖ Bill Period</h5>
  <div class="row">
    <div class="col-md-6">
      <label>From</label>
      <input type="date" class="form-control" id="billFrom">
    </div>
    <div class="col-md-6">
      <label>To</label>
      <input type="date" class="form-control" id="billTo">
    </div>
  </div>
</div>

<!-- ================= CONSUMPTION ================= -->
<div class="card p-3 mb-3">
  <h5>‚ö° Consumption & Charges</h5>
  <div class="row">
    <div class="col-md-4">
      <label>Gross Units</label>
      <input class="form-control" id="gross">
    </div>
    <div class="col-md-4">
      <label>Import Units</label>
      <input class="form-control" id="import">
    </div>
    <div class="col-md-4">
      <label>Export Units</label>
      <input class="form-control" id="export">
    </div>
  </div>

  <div class="row mt-2">
    <div class="col-md-4">
      <label>Fixed Charges (‚Çπ)</label>
      <input class="form-control" id="fixed">
    </div>
    <div class="col-md-4">
      <label>Total Bill Amount (‚Çπ)</label>
      <input class="form-control" id="totalBill">
    </div>
    <div class="col-md-4">
      <label>Arrears / Late Fee (‚Çπ)</label>
      <input class="form-control" id="arrears" value="0">
    </div>
  </div>
</div>

<!-- ================= REVISED ENTRY ================= -->
<div class="card p-3 mb-3 border-warning d-none" id="revisedSection">
  <div class="form-check form-switch">
    <input class="form-check-input" type="checkbox"
           id="isEdit" onchange="toggleEditReason()">
    <label class="form-check-label fw-bold">
      This is a corrected / revised entry
    </label>
  </div>

  <div id="editReasonBox" class="mt-2 d-none">
    <textarea class="form-control"
      id="editReason"
      placeholder="Reason for correction (if any)"></textarea>
  </div>
</div>

<button class="btn btn-primary btn-lg w-100"
        onclick="submitData()">
  üí∞ Calculate My Solar Saving
</button>

<div id="result" class="result-box mt-4 d-none"></div>

</div>

<!-- ================= FOOTER ================= -->
<footer>
  <div class="container d-flex justify-content-between flex-wrap">
    <div>
      <strong>Developed & Maintained by:</strong><br>
      National Informatics Centre (NIC), Kurukshetra
    </div>
    <div>
      <strong>Last Updated:</strong>
      <span id="lastModified"></span>
    </div>
  </div>
</footer>

<script>
/* ================= DOM REFERENCES ================= */
const manualCard     = document.getElementById("manualCard");
const scanCard       = document.getElementById("scanCard");
const identitySection= document.getElementById("identitySection");
const revisedSection = document.getElementById("revisedSection");
const result         = document.getElementById("result");

const billNumber = document.getElementById("billNumber");
const meter      = document.getElementById("meter");
const account    = document.getElementById("account");
const billFrom   = document.getElementById("billFrom");
const billTo     = document.getElementById("billTo");

const gross      = document.getElementById("gross");
const importU    = document.getElementById("import");
const exportU    = document.getElementById("export");
const fixed      = document.getElementById("fixed");
const totalBill = document.getElementById("totalBill");
const arrears   = document.getElementById("arrears");

const isEdit    = document.getElementById("isEdit");
const editReason= document.getElementById("editReason");
const editReasonBox = document.getElementById("editReasonBox");

let mode = "manual";

/* ================= MODE ================= */
function selectMode(m){
  mode = m;
  manualCard.classList.toggle("active", m === "manual");
  scanCard.classList.toggle("active", m === "scan");
}

/* ================= TOGGLES ================= */
function toggleIdentitySection(){
  const saveOption = document.querySelector(
    'input[name="saveOption"]:checked'
  ).value;

  identitySection.classList.toggle("d-none", saveOption !== "yes");
  revisedSection.classList.toggle("d-none", saveOption !== "yes");
}

function toggleEditReason(){
  editReasonBox.classList.toggle("d-none", !isEdit.checked);
}

/* ================= LOCAL CALC ================= */
function calculateLocally(){
  const g = Number(gross.value);
  const i = Number(importU.value);
  const e = Number(exportU.value);
  const f = Number(fixed.value);
  const t = Number(totalBill.value);
  const a = Number(arrears.value || 0);

  if (e > i || i > g) {
    alert("Please check Gross / Import / Export units.");
    return;
  }

  const net = i - e;
  const directSolar = g - i;
  const currentBill = t - a;
  const unitRate = (currentBill - f) / net;
  const billWithoutSolar = (g * unitRate) + f;
  const saving = billWithoutSolar - currentBill;

  result.classList.remove("d-none");
  result.innerHTML = `
    <h4>‚òÄÔ∏è Solar Saving Result</h4>
    <hr>
    <p><b>Gross:</b> ${g} units</p>
    <p><b>Imported:</b> ${i} units</p>
    <p><b>Exported:</b> ${e} units</p>
    <p><b>Direct Solar Used:</b> ${directSolar} units</p>
    <hr>
    <p><b>Bill With Solar:</b> ‚Çπ${currentBill.toFixed(0)}</p>
    <p><b>Bill Without Solar:</b> ‚Çπ${billWithoutSolar.toFixed(0)}</p>
    <h3 class="text-success">Saving: ‚Çπ${saving.toFixed(0)}</h3>
    <small class="text-muted">Calculated locally. No data saved.</small>
  `;
}

/* ================= SUBMIT ================= */
async function submitData(){
  const saveOption = document.querySelector(
    'input[name="saveOption"]:checked'
  ).value;

  if (saveOption === "no") {
    calculateLocally();
    return;
  }

  if (!billNumber.value.trim()) {
    alert("Bill Number required to save record.");
    return;
  }

  if (!meter.value.trim() && !account.value.trim()) {
    alert("Meter or Account Number required.");
    return;
  }

  const payload = {
    mode,
    billNumber: billNumber.value,
    meter: meter.value,
    account: account.value,
    billFrom: billFrom.value,
    billTo: billTo.value,
    gross: gross.value,
    import: importU.value,
    export: exportU.value,
    fixed: fixed.value,
    totalBill: totalBill.value,
    arrears: arrears.value,
    isEdit: isEdit.checked ? "yes" : "no",
    editReason: editReason.value
  };

  const res = await fetch(
    "https://n8n-workflow-test.duckdns.org/webhook/solar-saving",
    {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    }
  );

  result.classList.remove("d-none");
  result.innerHTML = await res.text();
}

/* ================= LAST MODIFIED ================= */
window.addEventListener("DOMContentLoaded", () => {
  toggleIdentitySection();

  const lmEl = document.getElementById("lastModified");
  if (lmEl) {
    lmEl.innerText = new Date(document.lastModified)
      .toLocaleString("en-IN", {
        day:"2-digit",
        month:"long",
        year:"numeric",
        hour:"2-digit",
        minute:"2-digit",
        second:"2-digit",
        hour12:true
      });
  }
});
</script>

</body>
</html>
