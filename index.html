<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SolarSanchay ‚Äì Haryana | Solar Savings Estimation Portal</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
  body {
    background:#f5f7fb;
  }
  .header {
    background:#ffffff;
    border-bottom:4px solid #0b5ed7;
    padding:12px 0;
  }
  .hero {
    background: linear-gradient(135deg,#0b5ed7,#084298);
    color:#fff;
    padding:25px;
    border-radius:10px;
    margin-bottom:25px;
  }
  .card {
    border-radius:10px;
  }
  .result-box {
    background:#e7f1ff;
    border-left:5px solid #0b5ed7;
    padding:20px;
    border-radius:8px;
  }
  footer {
    background:#ffffff;
    border-top:2px solid #dee2e6;
    margin-top:40px;
    padding:15px 0;
    font-size:14px;
  }
  .mode-card {
  cursor: pointer;
  border: 2px solid #dee2e6;
  transition: all 0.3s ease;
}
.mode-card:hover {
  border-color: #0b5ed7;
  box-shadow: 0 0 12px rgba(11,94,215,0.2);
}
.mode-card.active {
  border-color: #0b5ed7;
  background: #e7f1ff;
}
.form-check-input {
  transform: scale(1.3);
  cursor: pointer;
}
.border-warning {
  border-left: 5px solid #ffc107 !important;
}


</style>
</head>

<body>

<!-- ================= HEADER ================= -->
<div class="header">
  <div class="container d-flex align-items-center justify-content-between flex-wrap">
    
    <div class="d-flex align-items-center">
      <img src="assests/haryana-logo.jpg"
           alt="Government of Haryana"
           style="height:65px; margin-right:15px;">
      <div>
        <h4 class="mb-0 fw-bold">SolarSanchay ‚Äì Haryana</h4>
        <small class="text-muted">
          Solar Savings Estimation Portal
        </small>
      </div>
    </div>

    <div class="text-end mt-2 mt-md-0">
      <small class="text-muted d-block">
        Government of Haryana
      </small>
      <small class="text-muted">
        Powered by NIC, Kurukshetra
      </small>
    </div>

  </div>
</div>

<!-- ================= BODY ================= -->
<div class="container my-4">

  <!-- HERO -->
  <div class="hero">
    <h3>‚òÄÔ∏è SolarSanchay</h3>
    <p class="mb-1">
      Know how much money you have saved using your solar system,
      based on your actual electricity bill.
    </p>
    <small>
      Transparent ‚Ä¢ Audit-safe ‚Ä¢ Citizen-friendly
    </small>
  </div>

  <!-- MODE -->
  <div class="row mb-4">

  <div class="col-md-6">
    <div class="card mode-card active" onclick="selectMode('manual')" id="manualCard">
      <div class="card-body text-center">
        <div style="font-size:40px;">‚úçÔ∏è</div>
        <h5 class="mt-2">Enter Bill Details</h5>
        <p class="text-muted mb-0">
          Manually enter values from your electricity bill
        </p>
      </div>
    </div>
  </div>

  <div class="col-md-6">
    <div class="card mode-card" onclick="selectMode('scan')" id="scanCard">
      <div class="card-body text-center">
        <div style="font-size:40px;">üì∑</div>
        <h5 class="mt-2">Scan Electricity Bill</h5>
        <p class="text-muted mb-0">
          Upload bill image (OCR ‚Äì coming soon)
        </p>
      </div>
    </div>
  </div>

</div>

<div class="card p-3 mb-3">
  <h5>üîç Consumer Identification</h5>

  <div class="row">
    <div class="col-md-6">
      <label>Bill Number <span class="text-danger">*</span></label>
      <input class="form-control" id="billNumber" placeholder="As printed on bill">
    </div>
    <div class="col-md-6">
      <label>Meter Number</label>
      <input class="form-control" id="meter" placeholder="Optional if Account No is provided">
    </div>
  </div>

  <div class="row mt-2">
    <div class="col-md-6">
      <label>Account Number</label>
      <input class="form-control" id="account" placeholder="Optional if Meter No is provided">
    </div>
    <div class="col-md-6 d-flex align-items-end">
      <small class="text-muted">
        * Either Meter Number or Account Number is required
      </small>
    </div>
  </div>
</div>


  <!-- BILL PERIOD -->
  <div class="card p-3 mb-3">
    <h5>üìÖ Bill Period</h5>
    <div class="row">
      <div class="col-md-6">
        <label>From</label>
        <input type="date" class="form-control" id="billFrom">
      </div>
      <div class="col-md-6">
        <label>To</label>
        <input type="date" class="form-control" id="billTo">
      </div>
    </div>
  </div>

  <!-- MANUAL ENTRY -->
  <div class="card p-3 mb-3" id="manualSection">
    <h5>‚ö° Consumption Details</h5>

    <div class="row">
      <div class="col-md-4">
        <label>Gross Units</label>
        <input type="number" class="form-control" id="gross">
      </div>
      <div class="col-md-4">
        <label>Import Units (Grid)</label>
        <input type="number" class="form-control" id="import">
      </div>
      <div class="col-md-4">
        <label>Export Units (Solar)</label>
        <input type="number" class="form-control" id="export">
      </div>
    </div>

    <div class="row mt-2">
      <div class="col-md-4">
        <label>Fixed Charges (‚Çπ)</label>
        <input type="number" class="form-control" id="fixed">
      </div>
      <div class="col-md-4">
        <label>Total Bill Amount (‚Çπ)</label>
        <input type="number" class="form-control" id="totalBill">
      </div>
      <div class="col-md-4">
        <label>Arrears + Late Fee (‚Çπ)</label>
        <input type="number" class="form-control" id="arrears" value="0">
      </div>
    </div>
  </div>

  <!-- SCAN (FUTURE) -->
  <div class="card p-3 mb-3 d-none" id="scanSection">
    <h5>üì∑ Upload Electricity Bill</h5>
    <input type="file" class="form-control">
  </div>

  <!-- EDIT -->
<div class="card p-3 mb-3 border-warning">
  <div class="form-check form-switch">
    <input class="form-check-input" type="checkbox" id="isEdit" onchange="toggleEditReason()">
    <label class="form-check-label fw-bold" for="isEdit">
      This is a Corrected / Revised Bill Entry
    </label>
  </div>

  <div id="editReasonBox" class="mt-3 d-none">
    <label class="fw-semibold">Reason for Correction</label>
    <textarea class="form-control"
              id="editReason"
              rows="2"
              placeholder="e.g. Typing mistake / OCR error / Revised bill issued by DISCOM"></textarea>
  </div>
</div>

<div class="card p-3 mb-3">
  <h5>üìÅ Record Preference</h5>

  <div class="form-check mt-2">
    <input class="form-check-input" type="radio"
           name="saveOption" id="saveNo" value="no" checked>
    <label class="form-check-label fw-semibold" for="saveNo">
      Get result for this bill only (do not save record)
    </label>
    <div class="text-muted small">
      Recommended for quick check or shared computers
    </div>
  </div>

  <div class="form-check mt-3">
    <input class="form-check-input" type="radio"
           name="saveOption" id="saveYes" value="yes">
    <label class="form-check-label fw-semibold" for="saveYes">
      Save this bill for future reference
    </label>
    <div class="text-muted small">
      Enables cycle-wise solar saving history
    </div>
  </div>
</div>
<div class="text-muted small text-center mt-2">
  No personal data is stored without user consent.
</div>


  <button class="btn btn-primary w-100 btn-lg" onclick="submitData()">
    üí∞ Calculate My Solar Saving
  </button>

  <div id="result" class="result-box mt-4 d-none"></div>

</div>

<!-- ================= FOOTER ================= -->
<footer>
  <div class="container d-flex justify-content-between align-items-center flex-wrap">
    <div>
      <strong>Developed & Maintained by:</strong><br>
      National Informatics Centre (NIC), Kurukshetra
    </div>
    <div class="text-end">
      <strong>Last Updated:</strong>
      <span id="lastModified">Loading...</span>
    </div>
  </div>
</footer>

<!-- ================= SCRIPT ================= -->
<script>
let mode = "manual"; // default

function selectMode(selected) {
  mode = selected;
}
  // Toggle cards
  document.getElementById("manualCard").classList.toggle("active", selected === "manual");
  document.getElementById("scanCard").classList.toggle("active", selected === "scan");

  // Toggle sections
document.getElementById("manualSection")
  .classList.toggle("d-none", selected === "scan");
document.getElementById("scanSection")
  .classList.toggle("d-none", selected === "manual");}
function toggleEditReason() {
  document.getElementById("editReasonBox")
    .classList.toggle("d-none", !isEdit.checked);
}


async function submitData(){
    if (!billNumber.value.trim()) {
    alert("Please enter Bill Number.");
    return;
  }

  if (!meter.value.trim() && !account.value.trim()) {
    alert("Please enter either Meter Number or Account Number.");
    return;
  }
  if (!billFrom.value || !billTo.value) {
  alert("Please enter both Bill From and Bill To dates.");
  return;
}

const fromDate = new Date(billFrom.value);
const toDate = new Date(billTo.value);

if (toDate <= fromDate) {
  alert("Bill To Date must be later than Bill From Date.");
  return;
}

// Optional: calculate billing days
const billingDays = Math.round(
  (toDate - fromDate) / (1000 * 60 * 60 * 24)
);

// Soft warning (do NOT block)
if (billingDays < 15 || billingDays > 60) {
  alert(
    "Note: Billing period is " + billingDays +
    " days. Please ensure dates are correct."
  );
}
const saveOption = document.querySelector(
  'input[name="saveOption"]:checked'
).value;

 const data = {
  mode: mode,
  billNumber: billNumber.value,
  meter: meter.value,
  account: account.value,
  billFrom: billFrom.value,
  billTo: billTo.value,
  gross: gross.value,
  import: import.value,
  export: export.value,
  fixed: fixed.value,
  totalBill: totalBill.value,
  arrears: arrears.value,
  saveOption: saveOption,
  isEdit: isEdit.checked ? "yes" : "no",
  editReason: editReason.value
};

  const res = await fetch("https://n8n-workflow-test.duckdns.org/webhook/solar-saving",{
    method:"POST",
    headers:{ "Content-Type":"application/json"},
    body: JSON.stringify(data)
  });

  const html = await res.text();
  result.classList.remove("d-none");
  result.innerHTML = html;
}

</script>
<script>
window.addEventListener("DOMContentLoaded", function () {
  const el = document.getElementById("lastModified");
  if (el) {
    const lm = new Date(document.lastModified);
    el.innerText = lm.toLocaleString("en-IN", {
      day: "2-digit",
      month: "long",
      year: "numeric",
      hour: "2-digit",
      minute: "2-digit",
      second: "2-digit",
      hour12: true
    });
  }
});
</script>


</body>
</html>
